generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Account {
  id                String  @id @default(cuid())
  userId            String  @unique
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  subscribed        Boolean @default(false)

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Profile {
  id                String   @id @default(cuid())
  userId            String   @unique
  image_url         String?  @db.VarChar
  company           String?  @db.VarChar
  branch            String?  @db.VarChar
  department        String?  @db.VarChar
  title             String?  @db.VarChar
  use_profile_image Boolean  @default(false)
  created_at        DateTime @default(now()) @db.Timestamp(6)
  updated_at        DateTime @default(now()) @db.Timestamp(6)
  user              User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model User {
  id             String    @id @default(cuid())
  name           String?
  email          String?   @unique
  hashedPassword String    @db.VarChar
  emailVerified  DateTime?
  image          String?
  role           Role?     @default(USER)
  account        Account[]
  sessions       Session[]
  profile        Profile[]
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

enum Role {
  USER
  ADMIN
  DEVELOPER
}

model Property {
  id           String  @id @default(cuid())
  name         String
  sector_id    String
  subsector_id String?

  sector    Sector?    @relation(fields: [sector_id], references: [id], onDelete: Cascade)
  subsector SubSector? @relation(fields: [subsector_id], references: [id], onDelete: Cascade)

  location      Location?
  scale         Scale?
  facility      Facility?
  accessibility Accessibility?
  profitability Profitability?
  warehouse     Warehouse[]

  history              History[]
  propertyImageFile    PropertyImageFile[]
  propertyBrochureFile PropertyBrochureFile[]
  floor                Floor[]
  floorPlanFile        FloorPlanFile[]
  transaction          Transaction[]

  created_at DateTime @default(now()) @db.Timestamp(6)
  updated_at DateTime @default(now()) @db.Timestamp(6)
}

model PropertyImageFile {
  id                String  @id @default(cuid())
  property_id       String
  main              Boolean @default(false)
  file_uuid         String?
  file_name         String?
  file_key          String?
  file_url          String?
  file_content_type String?

  created_at DateTime @default(now()) @db.Timestamp(6)
  updated_at DateTime @default(now()) @db.Timestamp(6)
  property   Property @relation(fields: [property_id], references: [id], onDelete: Cascade)

  @@unique([property_id, file_uuid])
}

model PropertyBrochureFile {
  id          String @id @default(cuid())
  property_id String

  file_uuid         String?
  file_name         String?
  file_key          String?
  file_url          String?
  file_content_type String?

  created_at DateTime @default(now()) @db.Timestamp(6)
  updated_at DateTime @default(now()) @db.Timestamp(6)
  property   Property @relation(fields: [property_id], references: [id], onDelete: Cascade)

  @@unique([property_id, file_uuid])
}

model Sector {
  id   String @id @default(cuid())
  name String

  subsector SubSector[]
  Property  Property[]
}

model SubSector {
  id        String @id @default(cuid())
  sector_id String
  name      String
  sector    Sector @relation(fields: [sector_id], references: [id], onDelete: Cascade)

  Property Property[]
}

model Location {
  id                 String  @id @default(cuid())
  property_id        String  @unique
  address_full       String?
  address_full_jibun String?
  address_province   String?
  address_city       String?
  latitude           Float?  @db.DoublePrecision
  longitude          Float?  @db.DoublePrecision

  created_at DateTime @default(now()) @db.Timestamp(6)
  updated_at DateTime @default(now()) @db.Timestamp(6)

  property Property @relation(fields: [property_id], references: [id], onDelete: Cascade)
}

model Scale {
  id                                String @id @default(cuid())
  property_id                       String @unique
  no_of_buildings                   Int    @default(0)
  upper_levels                      Int    @default(0)
  basement_levels                   Int    @default(0)
  gfa_sqm                           Float? @db.DoublePrecision
  gfa_py                            Float? @db.DoublePrecision
  nfa_sqm                           Float? @db.DoublePrecision
  nfa_py                            Float? @db.DoublePrecision
  site_area_sqm                     Float? @db.DoublePrecision
  site_area_py                      Float? @db.DoublePrecision
  gross_leasable_area_sqm           Float? @db.DoublePrecision
  gross_leasable_area_py            Float? @db.DoublePrecision
  net_leasable_area_sqm             Float? @db.DoublePrecision
  net_leasable_area_py              Float? @db.DoublePrecision
  floor_area_ratio_existing         Float? @db.DoublePrecision
  floor_area_ratio_permitted        Float? @db.DoublePrecision
  building_coverage_ratio_existing  Float? @db.DoublePrecision
  building_coverage_ratio_permitted Float? @db.DoublePrecision
  floor_plate_sqm                   Float? @db.DoublePrecision
  floor_plate_py                    Float? @db.DoublePrecision

  created_at DateTime @default(now()) @db.Timestamp(6)
  updated_at DateTime @default(now()) @db.Timestamp(6)

  property Property @relation(fields: [property_id], references: [id], onDelete: Cascade)
}

model Warehouse {
  id               String          @id @default(cuid())
  property_id      String
  temperature_type TemperatureType
  ratio            Float?          @db.DoublePrecision

  created_at DateTime @default(now()) @db.Timestamp(6)
  updated_at DateTime @default(now()) @db.Timestamp(6)
  property   Property @relation(fields: [property_id], references: [id], onDelete: Cascade)

  @@unique([property_id, temperature_type])
}

enum TemperatureType {
  ROOM
  LOW
  CONSTANT
}

model Facility {
  id                    String  @id @default(cuid())
  property_id           String  @unique
  elevators_total       Int     @default(0)
  elevators_passenger   Int     @default(0)
  elevators_service     Int     @default(0)
  elevators_freight     Int     @default(0)
  cps_existing          Int     @default(0)
  cps_required          Int     @default(0)
  free_cps_sqm          Float?  @db.DoublePrecision
  free_cps_py           Float?  @db.DoublePrecision
  paid_parking_fee      Int?
  roof_material         String?
  facade                String?
  mechanical_electrical Int?
  lighting              String?
  fire_fighting         String?

  created_at DateTime @default(now()) @db.Timestamp(6)
  updated_at DateTime @default(now()) @db.Timestamp(6)

  property Property @relation(fields: [property_id], references: [id], onDelete: Cascade)
}

model Accessibility {
  id                      String  @id @default(cuid())
  property_id             String  @unique
  distance_to_ic          String?
  time_taken_to_city_hall String?
  time_taken_to_subway    String?
  nearby_facilities       String?
  nearby_attractions      String?
  nearby_places           String?

  created_at DateTime @default(now()) @db.Timestamp(6)
  updated_at DateTime @default(now()) @db.Timestamp(6)

  property Property @relation(fields: [property_id], references: [id], onDelete: Cascade)
}

model Profitability {
  id              String  @id @default(cuid())
  property_id     String  @unique
  grade           String?
  effective_ratio Float?  @db.DoublePrecision

  created_at DateTime @default(now()) @db.Timestamp(6)
  updated_at DateTime @default(now()) @db.Timestamp(6)

  property Property @relation(fields: [property_id], references: [id], onDelete: Cascade)
}

model Floor {
  id                  String        @id @default(cuid())
  property_id         String
  type                LevelType?
  floor               Int?
  ceiling_height      Float?        @db.DoublePrecision
  ceiling_height_unit String?       @default("m")
  floor_load          Float?        @db.DoublePrecision
  floor_load_unit     String?       @default("ton/„é°")
  truck_berths        Int?
  use                 FloorUseType?
  total_area_sqm      Float?        @db.DoublePrecision
  total_area_py       Float?        @db.DoublePrecision

  gross_leasable_area_sqm Float? @db.DoublePrecision
  gross_leasable_area_py  Float? @db.DoublePrecision

  net_leasable_area_sqm Float? @db.DoublePrecision
  net_leasable_area_py  Float? @db.DoublePrecision

  created_at DateTime @default(now()) @db.Timestamp(6)
  updated_at DateTime @default(now()) @db.Timestamp(6)

  floorPartial FloorPartial[]
  property     Property       @relation(fields: [property_id], references: [id], onDelete: Cascade)

  @@unique([property_id, type, floor])
}

model FloorPartial {
  id                                     String       @id @default(cuid())
  floor_id                               String
  unit_number                            String?
  tenant                                 String?
  lease_area_sqm                         Float?       @db.DoublePrecision
  lease_area_py                          Float?       @db.DoublePrecision
  tenant_equipment                       Boolean      @default(false)
  tenant_use                             RoomUseType?
  lease_start_date                       DateTime?    @db.Timestamp(6)
  lease_end_date                         DateTime?    @db.Timestamp(6)
  deposit_krw                            Int?
  monthly_rent_per_py                    Float?       @db.DoublePrecision
  monthly_rent                           Int?
  monthly_management_per_py              Float?       @db.DoublePrecision
  monthly_management_fee                 Int?
  increase_conditions_for_deposit        String?
  increase_conditions_for_rent           String?
  increase_conditions_for_management_fee String?
  rent_free                              String?
  fit_out                                String?

  created_at DateTime @default(now()) @db.Timestamp(6)
  updated_at DateTime @default(now()) @db.Timestamp(6)

  floor Floor @relation(fields: [floor_id], references: [id], onDelete: Cascade)
}

enum LevelType {
  UPPER
  BASEMENT
}

enum FloorUseType {
  ROOM
  OFFICE
  LOW
  CONSTANT
}

enum RoomUseType {
  DRY
  COLD
  OFFICE
  OTHERS
}

model FloorPlanFile {
  id                String        @id @default(cuid())
  property_id       String
  type              FloorFlanType
  floor             Int?
  file_uuid         String?
  file_name         String?
  file_key          String?
  file_url          String?
  file_content_type String?

  created_at DateTime @default(now()) @db.Timestamp(6)
  updated_at DateTime @default(now()) @db.Timestamp(6)

  property Property @relation(fields: [property_id], references: [id], onDelete: Cascade)

  @@unique([property_id, type, floor])
}

enum FloorFlanType {
  LOGITUDINALSECTION
  CROSSSECTION
  UPPERSECTION
  BASEMENTSECTION
}

model History {
  id          String      @id @default(cuid())
  property_id String
  year        String
  type        HistoryType

  created_at DateTime @default(now()) @db.Timestamp(6)
  updated_at DateTime @default(now()) @db.Timestamp(6)

  property Property @relation(fields: [property_id], references: [id], onDelete: Cascade)
}

enum HistoryType {
  COMPLETION
  RENOVATION
}

model Transaction {
  id             String          @id @default(cuid())
  property_id    String // üí° Ï∂îÍ∞Ä: PropertyÏôÄÏùò 1:N Í¥ÄÍ≥ÑÎ•º ÏúÑÌïú Ïô∏Îûò ÌÇ§
  type           TransactionType
  year           String
  quarter        String
  execution_date DateTime        @db.Timestamp(6)

  created_at DateTime @default(now()) @db.Timestamp(6)
  updated_at DateTime @default(now()) @db.Timestamp(6)

  property Property @relation(fields: [property_id], references: [id], onDelete: Cascade)

  // Sale/LeaseÏôÄ 1:1 Í¥ÄÍ≥ÑÎ•º ÏúÑÌïú Í¥ÄÍ≥Ñ ÌïÑÎìúÎßå ÎÇ®ÍπÅÎãàÎã§. (1:1ÏùÄ Sale/Lease Î™®Îç∏ÏóêÏÑú UniqueÎ°ú Í∞ïÏ†úÎê®)
  sale  Sale?
  lease Lease?
}

enum TransactionType {
  SALE
  LEASE
}

model Sale {
  id                String   @id @default(cuid())
  transaction_id    String?  @unique
  sale_type         SaleType
  gfa_sqm           Float?   @db.DoublePrecision
  nfa_sqm           Float?   @db.DoublePrecision
  price_krw         Int?
  price_per_gfa     Int?
  price_per_nfa     Int?
  est_cap_rate      Float?   @db.DoublePrecision
  est_discount_rate Float?   @db.DoublePrecision
  buyer             String?
  seller            String?

  remarks String?

  created_at DateTime @default(now()) @db.Timestamp(6)
  updated_at DateTime @default(now()) @db.Timestamp(6)

  // Í¥ÄÍ≥Ñ Ïù¥Î¶Ñ ÏÑ§Ï†ï ÌïÑÏöî: SaleDetail Îì± Î™ÖÌôïÌïòÍ≤å ÏßÄÏ†ïÌïòÎäî Í≤ÉÏù¥ Ï¢ãÏäµÎãàÎã§.
  Transaction Transaction? @relation(fields: [transaction_id], references: [id])
}

enum SaleType {
  ENBLOC
  PARTIAL
}

model Lease {
  id                               String        @id @default(cuid())
  transaction_id                   String?       @unique
  lease_type                       LeaseType?
  floor                            String?
  unit                             String?
  lease_start_date                 DateTime?     @db.Timestamp(6)
  lease_end_date                   DateTime?     @db.Timestamp(6)
  gfa_sqm                          Float?        @db.DoublePrecision
  gfa_py                           Float?        @db.DoublePrecision
  nfa_sqm                          Float?        @db.DoublePrecision
  nfa_py                           Float?        @db.DoublePrecision
  eff_ratio                        Float?        @db.DoublePrecision
  monthly_rent                     Int?
  monthly_camf                     Int?
  deposit                          Int?
  rent_monthly_py                  Int?
  camf_monthly_py                  Int?
  deposit_py                       Int?
  iod                              Float?        @db.DoublePrecision
  gdm                              Float?        @db.DoublePrecision
  noc                              Float?        @db.DoublePrecision
  lease_term_year                  Int?
  rent_free_type                   RentFreeType?
  rent_free_month                  Int?
  effective_noc                    Float?        @db.DoublePrecision
  fit_out                          Int?
  ti_amount_krw                    Float?        @db.DoublePrecision
  ti_amount_nfa_py                 Float?        @db.DoublePrecision
  total_free_rent_period_month     Int?
  total_occupying_period_year      Float?        @db.DoublePrecision
  total_free_rent_occupying_year   Float?        @db.DoublePrecision
  monthly_cash_support_gfa         Float?        @db.DoublePrecision
  all_in_effective_rent_monthly_py Float?        @db.DoublePrecision
  all_in_noc                       Float?        @db.DoublePrecision

  created_at DateTime @default(now()) @db.Timestamp(6)
  updated_at DateTime @default(now()) @db.Timestamp(6)

  // Í¥ÄÍ≥Ñ Ïù¥Î¶Ñ ÏÑ§Ï†ï ÌïÑÏöî
  Transaction Transaction? @relation(fields: [transaction_id], references: [id])
}

enum LeaseType {
  ASKING
  ACTUAL
}

enum RentFreeType {
  PerYear
  PerTerm
}
